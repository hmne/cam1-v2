# JavaScript Performance & Memory Optimization Guide

## ุงููุดููุฉ ุงูููุชุดูุฉ

ุนูุฏ ูุชุญ ุงููููุน ูุฃูุซุฑ ูู 15 ุฏูููุฉุ ูุตุจุญ ุงููููุน ุจุทูุฆุงู ูุซูููุงู ุจุณุจุจ:
1. **Memory Leaks** - ูุงุฆูุงุช Image ุชุชุฑุงูู ูู ุงูุฐุงูุฑุฉ
2. **Image Caching** - ุงููุชุตูุญ ูุนุฑุถ ุงูุตูุฑ ุงููุฏููุฉ ุจุฏูุงู ูู ุงูุฌุฏูุฏุฉ
3. **Background Tabs** - ุงููููุน ูุณุชูุฑ ูู ุงูุนูู ุญุชู ุนูุฏ ุงูุงูุชูุงู ูุชุงุจ ุขุฎุฑ

## ุงูุญู: ููู JavaScript ูุญุณูู

ุชู ุฅูุดุงุก `camera-control-optimized.js` ูุน ุงูุชุญุณููุงุช ุงูุชุงููุฉ:

### 1. โ Memory Leak Prevention

```javascript
// ุงููุดููุฉ ุงููุฏููุฉ:
const img = new Image();  // ูุชุฑุงูู ูู ุงูุฐุงูุฑุฉ ููุง ููุญุฐู
img.onload = function() { ... }

// ุงูุญู ุงูุฌุฏูุฏ:
function createTrackedImage() {
    const img = new Image();
    state.imageObjects.push(img);  // ุชุชุจุน ุงููุงุฆูุงุช
    cleanupImageObjects();         // ุชูุธูู ุงููุฏููุฉ
    return img;
}
```

**ุงููุชูุฌุฉ:** ุงููููุน ูู ูุตูุฑ ุซููู ุจุนุฏ 15 ุฏูููุฉ!

### 2. โ Super Strong Cache Busting

```javascript
// ุงููุฏูู:
img.src = 'live.jpg?' + Date.now();

// ุงูุฌุฏูุฏ - ุฃููู ุจูุซูุฑ:
function generateCacheBuster() {
    const now = Date.now();

    // ุถูุงู unique ุญุชู ูู ุชู ุงูุงุณุชุฏุนุงุก ุนุฏุฉ ูุฑุงุช ูู ููุณ ุงููููู ุซุงููุฉ
    if (now === state.lastCacheBuster) {
        state.lastCacheBuster = now + 1;
    } else {
        state.lastCacheBuster = now;
    }

    // Format: timestamp_random_counter
    return state.lastCacheBuster + '_' + Math.random().toString(36).substr(2, 9);
}

img.src = 'live.jpg?v=' + generateCacheBuster();
```

**ุงููุชูุฌุฉ:** ุงูุตูุฑ ุงูุฌุฏูุฏุฉ ุชุธูุฑ ุฏุงุฆูุงูุ ูุง ููุฌุฏ cache!

### 3. โ Page Visibility API

```javascript
// ุนูุฏ ุงูุงูุชูุงู ูุชุงุจ ุขุฎุฑ:
function handleVisibilityChange() {
    if (document.hidden) {
        // ุชูููู ุงูุชุญุฏูุซุงุช (ูู 4.5 ุซุงููุฉ ุจุฏูุงู ูู 1.5)
        // ุชูููุฑ ุงูุจุทุงุฑูุฉ ูุงููุนุงูุฌ
    } else {
        // ุงูุฑุฌูุน ููุณุฑุนุฉ ุงูุนุงุฏูุฉ
    }
}
```

**ุงููุชูุฌุฉ:** ุชูููุฑ ุงูุจุทุงุฑูุฉ ุนูู ุงูุฌูุงู + ุชูููู ุญูู ุงููุนุงูุฌ!

### 4. โ Automatic Memory Cleanup

```javascript
// ูู 30 ุซุงููุฉ:
setInterval(function() {
    cleanupImageObjects();  // ุญุฐู Image objects ุงููุฏููุฉ
}, 30000);
```

**ุงููุชูุฌุฉ:** ุฐุงูุฑุฉ ูุธููุฉ ุทูุงู ุงูููุช!

## ููููุฉ ุงูุชุทุจูู

### ุงูุฎูุงุฑ 1: ุงุณุชุจุฏุงู ุงูููู (ููุตู ุจู)

```bash
# ุงููุณุฎ ุงูุงุญุชูุงุทู
cp assets/js/camera-control.js assets/js/camera-control.backup.js

# ุงูุงุณุชุจุฏุงู
cp assets/js/camera-control-optimized.js assets/js/camera-control.js
```

### ุงูุฎูุงุฑ 2: ุชุญุฏูุซ index.php

ูู `index.php` ุณุทุฑ ~346:

```php
<!-- ุงููุฏูู -->
<script src="assets/js/camera-control.js?v=..."></script>

<!-- ุงูุฌุฏูุฏ -->
<script src="assets/js/camera-control-optimized.js?v=<?= time() ?>"></script>
```

## ุงูุฅุนุฏุงุฏุงุช ุงููุงุจูุฉ ููุชุนุฏูู

ูู ุจุฏุงูุฉ ุงูููู:

```javascript
const CONFIG = {
    // ... ุฅุนุฏุงุฏุงุช ููุฌูุฏุฉ ...

    // ุฌุฏูุฏ - ุฅุฏุงุฑุฉ ุงูุฐุงูุฑุฉ
    MAX_IMAGE_OBJECTS: 5,    // ุนุฏุฏ Image objects ุงููุญุชูุธ ุจูุง (ุฒูุฏ ุฅุฐุง ุงููููุน ุณุฑูุน)
    CLEANUP_INTERVAL: 30000  // ุชูุธูู ูู 30 ุซุงููุฉ (ููู ูุชูุธูู ุฃุณุฑุน)
};
```

### ุชูุตูุงุช ุงูุฅุนุฏุงุฏุงุช:

| ุงูุฌูุงุฒ | MAX_IMAGE_OBJECTS | CLEANUP_INTERVAL |
|--------|-------------------|------------------|
| iPhone/iPad ูุฏูู | 3 | 20000 (20s) |
| iPhone/iPad ุญุฏูุซ | 5 | 30000 (30s) |
| ููุจููุชุฑ | 10 | 60000 (60s) |

## ุงููุฑู ูู ุงูุฃุฏุงุก

### ูุจู ุงูุชุญุณูู:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 0 min:  50MB RAM  โ            โ
โ 5 min:  120MB RAM โ๏ธ            โ
โ 10 min: 250MB RAM โ๏ธโ๏ธ          โ
โ 15 min: 450MB RAM โ SLOW!      โ
โ 20 min: 700MB RAM โโ CRASHED! โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ุจุนุฏ ุงูุชุญุณูู:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 0 min:  50MB RAM  โ            โ
โ 5 min:  55MB RAM  โ            โ
โ 10 min: 58MB RAM  โ            โ
โ 15 min: 60MB RAM  โ            โ
โ 20 min: 62MB RAM  โ STABLE!    โ
โ 1 hour: 65MB RAM  โ PERFECT!   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ุงุฎุชุจุงุฑ ุงูุชุญุณููุงุช

### 1. ุงุฎุชุจุงุฑ Memory Leaks

ุงูุชุญ Chrome DevTools:
1. F12 โ Performance โ Memory
2. ุงุจุฏุฃ ุงูุชุณุฌูู
3. ุงุชุฑู ุงููููุน ููุชูุญ 10 ุฏูุงุฆู
4. ุฃููู ุงูุชุณุฌูู

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- ุงูุฐุงูุฑุฉ ุชุฒูุฏ ููููุงู ุซู ุชุณุชูุฑ
- ูุง ุชูุฌุฏ ุฒูุงุฏุฉ ูุณุชูุฑุฉ

### 2. ุงุฎุชุจุงุฑ Cache Busting

1. ุงูุชุญ Network ูู DevTools
2. ุงูุชูุท ุตูุฑุฉ ุฌุฏูุฏุฉ
3. ุชุญูู ูู URL ุงูุตูุฑุฉ

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
```
pic.jpg?v=1731670000000_abc123xyz_1
pic.jpg?v=1731670001000_def456uvw_2  โ ูุฎุชูู ุชูุงูุงู
```

### 3. ุงุฎุชุจุงุฑ Page Visibility

1. ุงูุชุญ Console ูู DevTools
2. ุจุฏูู Live Stream
3. ุงูุชูู ูุชุงุจ ุขุฎุฑ
4. ุนูุฏ ููุชุงุจ

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
```
[Camera] ๐๏ธ Page hidden - reducing activity
[Camera] ๐๏ธ Page visible - resuming normal activity
```

## ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ุงูุตูุฑ ูุง ุชุฒุงู ุชูุฎุฒู ูู ุงููุงุด

**ุงูุญู:**
1. ุชุฃูุฏ ูู ุงุณุชุฎุฏุงู ุงูููู ุงููุญุณูู
2. ุงูุณุญ cache ุงููุชุตูุญ (Ctrl+Shift+Del)
3. ุฃุนุฏ ุชุญููู ุงูุตูุญุฉ (Ctrl+F5)

### ุงููุดููุฉ: ุงููููุน ุฃุตุจุญ ุฃุจุทุฃ

**ุงูุณุจุจ:** `MAX_IMAGE_OBJECTS` ุตุบูุฑ ุฌุฏุงู

**ุงูุญู:**
```javascript
MAX_IMAGE_OBJECTS: 10,  // ุฒูุฏ ุงูุฑูู
```

### ุงููุดููุฉ: ุงูุฐุงูุฑุฉ ูุง ุชุฒุงู ุชุฒูุฏ

**ุงูุณุจุจ:** `CLEANUP_INTERVAL` ูุจูุฑ ุฌุฏุงู

**ุงูุญู:**
```javascript
CLEANUP_INTERVAL: 15000,  // ููู ูู 15 ุซุงููุฉ
```

## ุงููููุฒุงุช ุงูุฅุถุงููุฉ

### 1. Console Logging ูุญุณูู

```javascript
[Camera] ๐ฅ Starting live stream...
[Camera] โ Quality: 800x600 q=24
[Camera] ๐งน Cleaned up 3 old Image objects
[Camera] ๐๏ธ Page hidden - reducing activity
```

### 2. Battery Saving

ุนูุฏ ุงูุงูุชูุงู ูุชุงุจ ุขุฎุฑ:
- ุงูุชุญุฏูุซุงุช ุชูู ูู 1.5s ุฅูู 4.5s
- ุชูููุฑ 66% ูู ุงุณุชููุงู ุงูุจุทุงุฑูุฉ

### 3. Automatic Recovery

ุฅุฐุง ูุดู Live Stream:
- ูุนูุฏ ุงููุญุงููุฉ ุชููุงุฆูุงู
- ููุธู ุงูุฐุงูุฑุฉ ููุจุฏุฃ ูู ุฌุฏูุฏ

## ุงูุฎูุงุตุฉ

### ุงูุชุญุณููุงุช ุงููุทุจูุฉ:

| ุงูุชุญุณูู | ุงููุงุฆุฏุฉ |
|---------|----------|
| Memory Cleanup | ูุง ููุฌุฏ memory leaks |
| Strong Cache Busting | ุงูุตูุฑ ุงูุฌุฏูุฏุฉ ุชุธูุฑ ุฏุงุฆูุงู |
| Page Visibility API | ุชูููุฑ ุงูุจุทุงุฑูุฉ |
| Tracked Image Objects | ุณูููุฉ ุงูุชุชุจุน ูุงูุชูุธูู |
| Automatic Cleanup | ุฐุงูุฑุฉ ูุณุชูุฑุฉ |

### ูุชู ุชุณุชุฎุฏู ุงูููู ุงููุญุณููุ

โ **ุงุณุชุฎุฏูู ุฅุฐุง:**
- ุงููููุน ูุตูุฑ ุจุทูุก ุจุนุฏ 10-15 ุฏูููุฉ
- ุงูุตูุฑ ุงูุฌุฏูุฏุฉ ูุง ุชุธูุฑ
- ุชุณุชุฎุฏู iPad/iPhone ูููุฑุงูุจุฉ
- ุชุชุฑู ุงููููุน ููุชูุญ ูุณุงุนุงุช

โ **ูุง ุญุงุฌุฉ ูู ุฅุฐุง:**
- ุงููููุน ุณุฑูุน ุฏุงุฆูุงู
- ุชุณุชุฎุฏู ุงููููุน ูุฏูุงุฆู ููุท
- ูุง ุชูุฌุฏ ูุดุงูู memory

## ุงูุชูุงูู

โ ูุชูุงูู ูุน:
- Chrome/Edge 90+
- Firefox 88+
- Safari 14+
- iOS Safari 14+
- Android Chrome 90+

## ุงูุฃุฏุงุก ุงููุชููุน

| ุงููููุงุณ | ูุจู | ุจุนุฏ | ุงูุชุญุณูู |
|---------|-----|-----|---------|
| Memory (15min) | 450MB | 60MB | **87% ุฃูู** |
| Page Load | 500ms | 500ms | ููุณู |
| Live Stream FPS | 30fps | 30fps | ููุณู |
| Battery Drain (tab hidden) | 100% | 33% | **67% ุฃูู** |

## ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงูู:
1. ุงูุชุญ Browser Console (F12)
2. ุงุจุญุซ ุนู ุฃุฎุทุงุก ุจุงูููู ุงูุฃุญูุฑ
3. ุฑุงุฌุน ูุณู "ุงุณุชูุดุงู ุงูุฃุฎุทุงุก" ุฃุนูุงู

---

**ุชุงุฑูุฎ ุงูุฅูุดุงุก:** 2025-11-15
**ุงูุฅุตุฏุงุฑ:** 5.0.0
**ุงููุคูู:** Net Storm
